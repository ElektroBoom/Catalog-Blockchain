<!DOCTYPE html>

<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.css">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<title>
		Catalog BlockChain
	</title>
	<link rel="apple-touch-icon" href="https://i.imgur.com/cUm0ehh.png">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
	<meta name="author" content="Iulian Oancea">
	<meta http-equiv="Cache-control" content="public">
	<style>
		body {
			overflow: scroll;
		}

		@media only screen and (max-width: 1000px),
		(min-device-width: 600px) and (max-device-width: 860px) {

			table,
			thead,
			tbody,
			th,
			td,
			tr {
				display: block;
			}

			thead tr {
				position: absolute;
				top: -9999px;
				left: -9999px;
			}


			td {
				border: none;
				position: relative;
				padding-left: 50%;
				text-align: right
			}

			td:before {
				position: absolute;
				top: 5px;
				left: 5px;
				padding-right: 0px;
				white-space: nowrap;
			}

			td:nth-of-type(1):before {
				content: "Tip";
			}
			td:nth-of-type(2):before {
				content: "Materie";
			}
			td:nth-of-type(3):before {
				content: "Descriere";
			}
			td:nth-of-type(4):before {
				content: "Nota";
			}
			td:nth-of-type(5):before {
				content: "An invatamant";
			}
			td:nth-of-type(6):before {
				content: "Data";
			}
			td:nth-of-type(7):before {
				content: "Unitate de invatamant";
			}
			td:nth-of-type(8):before {
				content: "Specializare";
			}
			td:nth-of-type(9):before {
				content: "Comentariu";
			}

		}

		@media only screen and (min-device-width: 320px) and (max-device-width: 480px) {
			body {
				padding: 0;
				margin: 0;
				width: 400px;
			}
		}

		@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {
			body {
				width: 495px;
			}
		}

		.jumbotron {
			background: rgba(255, 255, 255, 0);
		}

		.loader {
			border: 10px solid lightgray;
			border-radius: 50%;
			border-top: 10px solid black;
			width: 50px;
			height: 50px;
			animation: spin .3s linear infinite;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}
			100% {
				transform: rotate(360deg);
			}
		}
	</style>
</head>

<body>
	<nav class="navbar navbar-expand-md bg-dark navbar-dark fixed-top font-weight-bold shadow-lg p-3 ">
		<a class="navbar-brand" href="https://github.com/ElektroBoom/Catalog-Blockchain" target="_blan">
			<img src="http://www.macdrifter.com/theme/images/octocat-snow.svg" width="36px">
		</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse justify-content-between" id="collapsibleNavbar">
			<ul class="nav navbar-nav">
				<li class="nav-item ">
					<a class="nav-link" href="#start" data-toggle="pill" id="acasa">
						<h5>Pagina de start</h5>
					</a>
				</li>
				<li class="nav-item ">
					<a class="nav-link" href="#mydata" data-toggle="pill">
						<h5>Chei</h5>
					</a>
				</li>
				<li class="nav-item ">
					<a class="nav-link" href="#rezultate" data-toggle="pill">
						<h5>Rezultate</h5>
					</a>
				</li>
				<li @click="loadBlockChain" class="nav-item ">
					<a class="nav-link" href="#blockchain" data-toggle="pill">
						<h5>BlockChain</h5>
					</a>
				</li>
				<div class="dropdown-divider"></div>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li class="nav-item ">
					<div class="input-group ">
						<input type="text" class="form-control font-weight-bold" placeholder="ID Persoana">
						<div class="input-group-append">
							<span class="input-group-text badge-dark bg-dark">
								<a href="#search" data-toggle="pill">
									<img src="https://i.imgur.com/q0hJfxt.png" width="24px">
								</a>
							</span>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</nav>
	<div class="tab-content" id="app">
		<div style="margin-top: 100px"></div>

		<div v-if="incarca" class="loader container"></div>
		<br>

		<div v-if="succes" id="alertaSucces" class="alert alert-success container" role="alert">
			{{succes}}
		</div>
		<div v-if="eroare" id="eroare" class="alert alert-danger container" role="alert">
			{{eroare}}
		</div>
		<div id="start" class="tab-pane fade in" style="margin-top: 100px">
			<div class="container">
				<div class="jumbotron  animated bounceInDown">
					<h1 class="text-center ">Catalog BlockChain</h1>
					<h2 class="text-center ">Oancea Iulian</h2>
					<h2 class="text-center ">ACIEE</h2>
					<h2 class="text-center ">CTI</h2>
					<h2 class="text-center ">2018</h2>
				</div>
			</div>
		</div>
		<div id="mydata" class="tab-pane fade in">
			<div class="container">
				<div class="input-group">
					<button @click="loadCarnet" class="btn btn-dark form-control">
						Incarca chei
					</button>
					<button @click="createCarnet" class="btn btn-dark form-control">
						Genereaza chei
					</button>
				</div>
				<br>
				<div class="card card-body shadow-lg">
					<h2>Cheile mele</h2>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text badge-dark">Cheie publica:</span>
						</div>
						<input type="text" class="form-control" readonly v-model="public_key" id="publica">
						<div class="input-group-append">
							<button class="btn btn-dark" onclick="copiaza('publica')">Copy</button>
						</div>
					</div>
					<div class="input-group mb-3">
						<div class="input-group-prepend">
							<span class="input-group-text badge-dark">Cheie privata:</span>
						</div>
						<input type="text" class="form-control" readonly v-model="private_key" id="privata">
						<div class="input-group-append">
							<button class="btn btn-dark" onclick="copiaza('privata')">Copy</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="rezultate" class="tab-pane fade in">
			<div class="container">
				<div class="input-group">
					<button onclick="$('#introducereRezultat').collapse('hide');" class="btn btn-dark form-control" data-toggle="collapse" data-target="#rezultateleMele"
					 id="btnRezultate">
						Afiseaza rezultat
					</button>
					<button onclick="$('#rezultateleMele').collapse('hide');" class="btn btn-dark form-control" data-toggle="collapse" data-target="#introducereRezultat">
						Insereaza rezultat
					</button>
				</div>
				<br>
				<div class="collapse" id="rezultateleMele">
					<div class="card card-body shadow-lg">
						<form @submit.prevent="getRezultateId">
							<div class="input-group ">
								<input type="text" v-model="cheieRezultate" class="form-control font-weight-bold" placeholder="Cheie publica">
								<div class="input-group-append">
									<button type="submit" class="btn btn-dark">
										<img src="https://i.imgur.com/q0hJfxt.png" width="24px">
									</button>
								</div>
							</div>
						</form>
						<h2 v-if="rezultate.length > 0">Rezultate</h2>
						<table v-if="rezultate.length > 0" class="table table-dark table-striped shadow-lg text-center">
							<thead class="font-weight-bold">
								<tr>
									<th>Tip</th>
									<th>Materie</th>
									<th>Descriere</th>
									<th>Nota</th>
									<th>An invatamant</th>
									<th>Data</th>
									<th>Unitate de invatamant</th>
									<th>Specializare</th>
									<th>Comentariu</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="rez in rezultate">
									<td>{{rez.rezultat.tip_info}}</td>
									<td>{{rez.rezultat.materie}}</td>
									<td>{{rez.rezultat.descriere}}</td>
									<td>{{rez.rezultat.nota}}</td>
									<td>{{rez.rezultat.an_scolar}}</td>
									<td>{{rez.rezultat.data_intamplarii}}</td>
									<td>{{rez.rezultat.unitate_invatamant}}</td>
									<td>{{rez.rezultat.specializare}}</td>
									<td>{{rez.rezultat.comentariu}}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="collapse" id="introducereRezultat">
					<div class="card card-body shadow-lg">
						<h2>Introducere Rezultat</h2>
						<form @submit.prevent="addRezultat">
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Receptor</span>
								</div>
								<input type="text" class="form-control" v-model="rezultat.receptor" placeholder="cheia publica a student-ului" required>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Materie</span>
								</div>
								<input type="text" class="form-control" v-model="rezultat.materie" placeholder="ex: PCLP / Matematica" required>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<label class="input-group-text badge-dark" for="inputGroupSelect01">Tip rezultat</label>
								</div>
								<select class="custom-select" v-model="rezultat.tip_info" id="inputGroupSelect01" onchange="$('#inputGroupSelect01').val()=='Nota'?$('#nota').collapse('show'):$('#nota').collapse('hide');">
									<option value="Nota">Nota</option>
									<option value="Absenta">Absenta</option>
								</select>
							</div>
							<div class="input-group mb-3" id="nota">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Nota</span>
								</div>
								<input type="number" step="any" v-model="rezultat.nota" class="form-control" placeholder="de la 1 la 10" min="1" max="10"
								 pattern="^([1-9]\.{0,1}[0-9]{0,2}|10)$">
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Unitate de invatamant</span>
								</div>
								<input type="text" v-model="rezultat.unitate_invatamant" class="form-control" placeholder="ex: ACIEE / UPB" required>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Specializare</span>
								</div>
								<input type="text" v-model="rezultat.specializare" class="form-control" placeholder="ex: CTI / IS" required>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">An invatamant</span>
								</div>
								<input type="text" v-model="rezultat.an_scolar" class="form-control" placeholder="ex: 3/ 4" required>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Data</span>
								</div>
								<input type="date" v-model="rezultat.data_intamplarii" class="form-control" placeholder="ex: 2018-01-01">
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Descriere materie</span>
								</div>
								<input type="text" v-model="rezultat.descriere" class="form-control">
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span class="input-group-text badge-dark">Comentariu</span>
								</div>
								<input type="text" v-model="rezultat.comentariu" class="form-control">
							</div>

							<div class="input-group">
								<button type="submit" :disabled="rezultatSubmitDisabled" class="btn btn-secondary form-control">
									Adauga
								</button>
								<button class="btn btn-secondary form-control" type="reset" id="btnReset">
									Reseteaza campuri
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div id="blockchain" class="tab-pane fade in">
			<div class="container">
				<div class="input-group">
					<button @click="loadBlockChain" class="btn btn-dark form-control">
						Afiseaza blockchain
					</button>
					<button @click="mine" class="btn btn-dark form-control">
						Mineaza block
					</button>
				</div>
				<br>
				<div class="scroll ">
					<div v-if="blockchain.length > 0" class="card card-body shadow-lg">
						<pre>
							{{blockchain}}
						</pre>
					</div>
				</div>
			</div>
		</div>

		<div id="search" class="tab-pane fade in" style="margin-top: 100px">
			<div class="container">
				<h3>search 1</h3>
			</div>
		</div>
	</div>

	<script>
		var vm = new Vue({
			el: '#app',
			data: {
				blockchain: [],
				rezultate: [],
				succes: null,
				eroare: null,
				incarca: false,
				private_key: null,
				public_key: null,
				cheieRezultate: null,
				rezultat: {
					receptor: '',
					info_didactic: {
						tip_info: '',
						materie: '',
						descriere: '',
						an_scolar: '',
						nota: null,
						data_intamplarii: '',
						unitate_invatamant: '',
						specializare: '',
						comentariu: ''
					}
				},
				rezultatSubmitDisabled: false
			},
			mounted() {
				$("#acasa").click();
				$("#btnReset").click()
				$("#nota").collapse('show');
			},
			methods: {
				loadBlockChain: function () {
					this.incarca = true
					var vm = this
					axios.get('/chain')
						.then(function (response) {
							vm.eroare = null;
							vm.blockchain = response.data;
							vm.incarca = false;
						}).catch(function (error) {
							vm.eroare = error.data.message;
							vm.incarca = false;
						});
				},
				loadCarnet: function () {
					this.incarca = true
					var vm = this
					axios.get('/carnet')
						.then(function (response) {
							vm.eroare = null;
							vm.private_key = response.data.private_key;
							vm.public_key = response.data.public_key;
							vm.incarca = false
						}).catch(function (error) {
							eroare = error.response.data.message
							vm.private_key = null;
							vm.public_key = null;
							vm.incarca = false
						});
				},
				createCarnet: function () {
					this.incarca = true
					var vm = this
					axios.post('/carnet')
						.then(function (response) {
							vm.eroare = null;
							vm.private_key = response.data.private_key;
							vm.public_key = response.data.public_key;
							vm.incarca = false;
						}).catch(function (error) {
							vm.eroare = error.response.data.message
							vm.private_key = null;
							vm.public_key = null;
							vm.incarca = false;
						});
				},
				mine: function () {
					this.incarca = true
					var vm = this
					axios.post('/mine')
						.then(function (response) {
							vm.eroare = null;
							vm.succes = 'Block minat cu succes';
							vm.incarca = false
						}).catch(function (error) {
							vm.eroare = error.response.data.message;
							vm.incarca = false;
						})
				},
				addRezultat: function () {
					this.incarca = true
					var vm = this
					axios.post('/rezultat', {
						receptor: vm.rezultat.receptor,
						info_didactic: {
							tip_info: vm.rezultat.tip_info,
							materie: vm.rezultat.materie,
							descriere: vm.rezultat.descriere,
							nota: vm.rezultat.nota,
							an_scolar: vm.rezultat.an_scolar,
							data_intamplarii: vm.rezultat.data_intamplarii,
							unitate_invatamant: vm.rezultat.unitate_invatamant,
							specializare: vm.rezultat.specializare,
							comentariu: vm.rezultat.comentariu
						}
					})
						.then(function (response) {
							vm.eroare = null;
							vm.succes = response.data.message;
							vm.incarca = false;
						}).catch(function (error) {
							vm.success = null;
							vm.eroare = error.response.data.message;
							vm.incarca = false;
						})
				},
				getRezultateId: function () {
					this.incarca = true
					var vm = this
					axios.post('/rezultat_id', {
						id: vm.cheieRezultate
					}).then(function (response) {
						vm.eroare = null;
						vm.succes = response.data.message;
						vm.rezultate = response.data.rezultate
						console.log(response.data)
						vm.incarca = false;
					}).catch(function (error) {
						vm.success = null;
						vm.eroare = error.response.data.message;
						vm.incarca = false;
					})
				}
			}
		})
		function copiaza(camp) {
			document.getElementById(camp).select();
			document.execCommand("copy");
		}
		$('.navbar-nav>li>a').on('click', function () {
			$('.navbar-collapse').collapse('hide');
		});
	</script>
</body>

</html>